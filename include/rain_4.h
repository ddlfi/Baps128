#pragma once

#include <array>
#include <cassert>
#include <cstdint>
#include <vector>

#include "gsl-lite.hpp"
#include "types.h"

constexpr static size_t NUM_SBOXES = 4;
constexpr static size_t BLOCK_SIZE = 16;
constexpr static size_t KEY_SIZE = 16;

// --- ROUND CONSTANTS ---
// Round 0:
// 0x1d8a22f87e12e486d8803d990c64569b
// Round 1:
// 0xddd0523e2f415ca0a4e2745a5a9f9019
// Round 2:
// 0xc20f5c2b8ae8ea01007e82d809a22b5e
// Round 3:
// 0x334f34591133bd0a09b0a1d9aae702fc
constexpr static field::GF2_128 roundconst[4] = {
    {std::array<uint64_t, 2>{0xd8803d990c64569b, 0x1d8a22f87e12e486}},
    {std::array<uint64_t, 2>{0xa4e2745a5a9f9019, 0xddd0523e2f415ca0}},
    {std::array<uint64_t, 2>{0x007e82d809a22b5e, 0xc20f5c2b8ae8ea01}},
    {std::array<uint64_t, 2>{0x09b0a1d9aae702fc, 0x334f34591133bd0a}},
};

alignas(32) constexpr static std::array<uint64_t, 2> m1_transposed[128] = {
    {{0x26d8807f43827265, 0xc1d509570733fbed}},
    {{0x86298e3b98510dd2, 0xb9136b07ebbed379}},
    {{0x77c1a383c38f7317, 0x2477d2aa2b83a4d8}},
    {{0xa12f87ced2e8809a, 0xfc3633c25eeaaf06}},
    {{0xdf1f0a09bb904c87, 0xbd6f6fae70c63ca2}},
    {{0x55c6465ad06515ce, 0x3d79cf77065ef8dd}},
    {{0x9ab4c64fb2871c17, 0xeebdabe6353baa4f}},
    {{0xf7bfc243c2e7ef03, 0xc36acc5fb2bb57f}},
    {{0xb97142df830c5f6f, 0xd693dce3b3c1af29}},
    {{0x8cf223256102482b, 0xac1c689597c2d803}},
    {{0xcd098d39e186c3fe, 0x1843904dcb18a31c}},
    {{0xd2a3bb098b5ea4ab, 0xfc088aeb76ba8949}},
    {{0x503d91cf05f0ae29, 0x2636a6eaa0fa5f0f}},
    {{0x5b54b0948869d027, 0x5cf43e9b7ec0a75c}},
    {{0x843074690e29ca07, 0xf6d7708e11c47c02}},
    {{0xe0bbc97aeefbfa37, 0x4a40d9c0a5657a43}},
    {{0x42a5dd3e53644e22, 0x86133a5dc2aeeb29}},
    {{0xaddbae475300f345, 0xb0d039ec1ce7d98}},
    {{0xf146b58ae603626c, 0xc78867c0a1bc402}},
    {{0x113720a7248fa325, 0x1ed93fa9ddb3f8b0}},
    {{0x3a53a977907032d0, 0xd9de908d47b78ab7}},
    {{0x5001c21e610a19a1, 0x964c1f19b9159620}},
    {{0x7ad064fa5c24ae09, 0x437f7843f32bb5db}},
    {{0xfeffa5cd212046a4, 0x35814e8d0b009cfe}},
    {{0x8f281872e8e48cee, 0x716f70828ffa4e93}},
    {{0x411283fcb1d8c4bb, 0x222722fbcc12c874}},
    {{0xa75980fce1e42f07, 0x69035812bd9e79cc}},
    {{0xaaac513740c07929, 0x531fe0f0671c68dc}},
    {{0xc0b2d729396b7d60, 0x44d2e0f6934133d8}},
    {{0x3ca1eda09bfe17d9, 0x1631aeb659871b25}},
    {{0xb4271dc055f41a0d, 0xb87f27aaadaa2f91}},
    {{0x6d31800c2db1960c, 0x430cc455bb26218}},
    {{0x7b89adb0864e985b, 0x7359e1a68d852961}},
    {{0x5f05ae7ef152f458, 0xf44fc1bdebc4ac1a}},
    {{0x2057d8959925e531, 0x169ea0317116177}},
    {{0x8670fa30f00296a, 0xf5f2a79c87d85b48}},
    {{0xa011da547f81704e, 0xf93ade7b4dd2d5ad}},
    {{0xca17ded7a9157d89, 0xde2ee923c4a14c8b}},
    {{0x18bea4cec660b917, 0xcb19946734a7e402}},
    {{0x2acfde17a4a07336, 0xcc57e6f8e7f0e81d}},
    {{0x745f0349d783364d, 0xefaec5d8925f7a6}},
    {{0x331830b51985df56, 0xb05dac07c3692031}},
    {{0x2e61e4ed9eda47a3, 0xc9b062d0e74f2b47}},
    {{0xaa183cfe6b5ecddb, 0x9435709bfcb4f7b4}},
    {{0xc1ebd51812e64fdf, 0x292c46172ac0d43d}},
    {{0x3b80e6729f6d09a6, 0x38d9c9441abd0bca}},
    {{0xd858c674d73ec2e5, 0x134acef9dc783246}},
    {{0x3e67236d9df6c4e7, 0x6005dd22c6f6a78a}},
    {{0x2571f422e2cc0f89, 0x4257d019cb3ee5b0}},
    {{0xac00bba2875d255e, 0x5304dc8d437fe64d}},
    {{0x63df6061833358c9, 0x43e407965c8c122a}},
    {{0xad91a9a7bfd5430e, 0xe3ae276604c26dc4}},
    {{0x529b15704603c82d, 0xcaabe2adf59378d3}},
    {{0xb80b9f5fb3b72e51, 0xd748ded96f28153b}},
    {{0x9102797d1423cda1, 0x16673946709235d0}},
    {{0xa04470faf502a8d8, 0xb9fa95bbb75b0be9}},
    {{0x6da4853420fb23ff, 0x10f86f78e147eb9e}},
    {{0xf9dedbab74753c0a, 0xdd338b6a9432ea3d}},
    {{0x4290c7845b314e15, 0x1767a6c93fcc4eab}},
    {{0x80f99e12ca8f68dd, 0xd3d4c6cdfc45ab2}},
    {{0x7f471e8756edde10, 0x2fb999a959ba8287}},
    {{0xf7cd0970e523aaea, 0x9e388a11264d15a6}},
    {{0x442a2c6296714bc3, 0x346331c246620bd6}},
    {{0xd72ddd2b3e69f270, 0x4dd9590e504e6f3c}},
    {{0xa362852c636d7673, 0xda7a0096a4eab4e5}},
    {{0x4945f22139110e88, 0xb0e041a61c165e14}},
    {{0x67430dbe177662d, 0xa8eaf3fbf8ef8cbd}},
    {{0x7a4be1a4331e043d, 0x9af75655fb5166cd}},
    {{0xd7e6be028f8b4fa5, 0xb0c19bb6b669ffc0}},
    {{0xc3fa5db7396fff1f, 0xac5aacaad098333c}},
    {{0x4fd4ffc20848207c, 0x42fa4b68f4203f9f}},
    {{0xa09317af0c694fd, 0xaca0fa0af802aa2f}},
    {{0xcde61ae52e43187a, 0x861519cf4c229592}},
    {{0x7d1a133f3e57a13b, 0x16b181e5ef28d7}},
    {{0x1fa822b6d14656ba, 0xe433123328b629a}},
    {{0xdf1da455b8b62688, 0x3dce8e27b657f93d}},
    {{0xe217a7c2f69427f1, 0xf4a458c323dfb2d}},
    {{0xcef1f6b94b1e3249, 0x42433654fc8fa42a}},
    {{0x5de3a0da60a674ad, 0xccd0129494301da9}},
    {{0x37cd66feae56c416, 0x246a45600a974009}},
    {{0xbbe441b295ceaca5, 0xc80b49e1ad42421f}},
    {{0xcb5512672a670b73, 0x87a3bf8234015823}},
    {{0x909a1d1ee108a24c, 0xfe3841c54c91e9a}},
    {{0x9a684c90add6f857, 0xb7a0914da99feb5b}},
    {{0x701344883e674dbc, 0x96c1ba44070c330a}},
    {{0x965bb7d8738fa75b, 0x183c006394b86aa8}},
    {{0xc10cd366904308b9, 0xac8ad3e49c9710d5}},
    {{0xf2f611a740907c85, 0x3b9c25fe4b08b0f1}},
    {{0x5fc226ab09fe7521, 0x38b246f00351043b}},
    {{0xd69cd0bd4be3c100, 0xe47b6a3e56a71aea}},
    {{0x3c18bd3d2fdc8f18, 0x660bed52ac21b635}},
    {{0xea7c3aa92cd7f843, 0x2508fd9ec9787811}},
    {{0x71f976f090ccf7ee, 0x1c7c6edad70dccb5}},
    {{0xa505a723d5c0c1e4, 0xd2af2f02b39e9a8d}},
    {{0x4245b2ec535e5536, 0xae6741acc428ccb9}},
    {{0x1498e6e71469f5cf, 0x583554de9c05975e}},
    {{0x2fb5ef30c1b7e870, 0x3c690cea3702a4e3}},
    {{0xd50b63c26964223c, 0xc7c05f9c1228b06a}},
    {{0x4aabe76b26e14156, 0xae2382df5bffeced}},
    {{0x32c1a41a800c5a8a, 0x66a4e47c5abcf896}},
    {{0x5b175cb32fc106a0, 0xa7f91d7f926527c1}},
    {{0xd5d987bb9af6b3a, 0x845a1feb7efe35ce}},
    {{0x6741b273883933fc, 0x9a6a4e2cc80022ff}},
    {{0x25b1ce100f416f73, 0x479de3d6a0be4a8}},
    {{0x655707acbfdec87f, 0x555ab1e1e191a6af}},
    {{0x3b8f2e848f58e87, 0xdc0c545eacb22c99}},
    {{0x1bb2a80ccfb18f7a, 0x86a0a63c5bfa9a1c}},
    {{0xcc692fc1fc8bda4c, 0x79df9ebb3a19e2d}},
    {{0x75c67616359c52ca, 0xfb2d08a229731aa9}},
    {{0xab9adc0f48f8bea3, 0x4ce663034c991a4}},
    {{0x4bca33d9ce45aa6b, 0x19df11728fdd5ee6}},
    {{0xad31000b1fd1e632, 0x397261126d74c156}},
    {{0x9e2e975ddc138286, 0x5daf70bd63f1e57a}},
    {{0x4bceba986c80cdcd, 0xf81d14996fdc190d}},
    {{0x313a7ee24d6006fc, 0xd875b2c3483f359c}},
    {{0xaf5f4c4325117308, 0x4cbcfc7733b5fc70}},
    {{0x86dcfd23c88d21df, 0x380feeffb9bde06c}},
    {{0xbe001ce885f89314, 0x18d5045cf7bbe1fc}},
    {{0x26e9a79c172f0345, 0xabfb13a920c73761}},
    {{0x1c4ace6e73eae428, 0xc4216bd3c3cfbbb6}},
    {{0xb0365445c2a98bda, 0x58516768014cd5de}},
    {{0xfd3f0ae2926148d2, 0xf1aa99c96189f654}},
    {{0x3568a4b48ee1766d, 0x75213febf6166fe9}},
    {{0x59afb910d3745286, 0x9f4ba8008a334393}},
    {{0xb4e3d3f61bfefa6c, 0x32c98686f56c7d}},
    {{0x531f14455fea61d3, 0x7a16b5e1bbc78087}},
    {{0xea9dfbba20495160, 0x6c7d35fb3982840}},
    {{0xfff84e653d144c34, 0x57c3c19a3289101e}},
};

alignas(32) constexpr static std::array<uint64_t, 2> m2_transposed[128] = {
    {{0x16950e9e85616d8, 0xe2ee233a23e94bc0}},
    {{0xd87a4824d5cd63df, 0xa216258b683052a1}},
    {{0x41cddd2003e86614, 0xd7d1eb9a3ea2e399}},
    {{0x2c9d14cb50f34f3a, 0xa13cca1ea1a07a02}},
    {{0x5b74d16a5d51d3b2, 0x59866a62bfb162e0}},
    {{0x470317be39937ed7, 0x5338b59c37837003}},
    {{0x82c9756bd5ef2075, 0x59113554424bc6f3}},
    {{0xb00142eb016c0027, 0x4c20c0458e31ddc7}},
    {{0x57e6f9ca35e0193f, 0xd5dbfe573ec407c3}},
    {{0x32e6cfb4d21a591b, 0x1272883aab4835fa}},
    {{0x691c0cb73276f252, 0xc751619cf4063a53}},
    {{0x4824976218a123f5, 0xbe6c53c5d90bd8a9}},
    {{0x1d5ec400644025de, 0x602b88c3bd6ab02b}},
    {{0xebf0fb757766175d, 0xebc12fe14d7c5e62}},
    {{0x9715d7ceb546c630, 0xd991e6903d6b0c6c}},
    {{0xdcbd9742e4289e1a, 0x936f7890549169fb}},
    {{0x299735958420a121, 0x62b0224d6c8feedc}},
    {{0xe2390e70f393046f, 0xe8947425e989d6f8}},
    {{0x3d01ce3bf90ac02d, 0xa4ab037f59422aa7}},
    {{0x167ae807cf25f1f6, 0x91f30cb2e62c79b}},
    {{0xe6a254ea1bc7e66f, 0x3aa891c1816b6132}},
    {{0xa29799e8a8174562, 0x51ef28b8f757a661}},
    {{0x7418b43b5b2384e0, 0x9bd5245463bdf50f}},
    {{0x7fb39df6a54d8934, 0xdfa4aac686476faa}},
    {{0x6457cd7ce728bcaf, 0x728db231e262b800}},
    {{0xd3fe4ce1327dc2c5, 0x5b5c30f8717b2852}},
    {{0xcc09877fa739be3d, 0xbfeba55c0fdb9819}},
    {{0xe9f266fa67957dda, 0x953f1a731548efe7}},
    {{0xd174026c967663bb, 0x63f64e1df3ddfcc2}},
    {{0x544cf00aeea73f13, 0xd1a62016dc425220}},
    {{0x66ca2ce09e11646b, 0x10c0314ceb84744a}},
    {{0xbca9790a5b45fb5b, 0x71285648376ccb6e}},
    {{0xdd6811204fa3e798, 0x3aa65cb4cb3014d4}},
    {{0x989a8d94f7865f18, 0x5a96b7140d06b368}},
    {{0x936a85c6f2806a8d, 0xa9cf395269628ca2}},
    {{0xad412f22579fab34, 0x9f5e74fe8bf02806}},
    {{0xa18f4642b92f1c5e, 0x5fd3519bb85b8f2a}},
    {{0xebb135046602e37b, 0x85acb322b5cd28a2}},
    {{0x85edbfa97b611c17, 0x4530ff898fbcdfd8}},
    {{0xd0cfa31157ba7aaa, 0x8b05859baea6335a}},
    {{0x910bb6223463ef33, 0x22ff5bf393e91afe}},
    {{0x2fd356822c50b596, 0x1a43d7736d9a625a}},
    {{0x3b222dbd2ab1bd88, 0x8bee73c3140312a4}},
    {{0x6ad831432fc68f02, 0xf9f2ffc8fb1cefcb}},
    {{0x8f2209de9f42417b, 0xb549c8e10b7a6c8f}},
    {{0x4e1513506eb49c5d, 0xea4c43e130d2a47b}},
    {{0x29268f253a6a777, 0xaf9f7ccbbb89797}},
    {{0x85481cf16867aa19, 0x9aa777c875f9ca}},
    {{0xbcaea29ee8f8606d, 0xf2a21922479146fa}},
    {{0xa9683b6efb45cdda, 0x5bdba1806ec8ce03}},
    {{0xde0f28c32be82d2f, 0xb029bfcd70ff7d0c}},
    {{0xf3e87b2c18d7aff6, 0x9d10b23f2d14f290}},
    {{0x76ee1122370435c7, 0xc01e584cc961d338}},
    {{0xe74e91368a3905b4, 0x9b33c28038269368}},
    {{0xcbdebf05f32bdb67, 0xb25fb1fd57048559}},
    {{0xe2567292db6413fb, 0x25d7948b85387e9b}},
    {{0x67261c0d34254a6d, 0x4bcaefe515e63506}},
    {{0x95c9d285824dc10f, 0x750cc76f6567400f}},
    {{0xa6b5d392d4b5645d, 0x85bf933c1dc9257}},
    {{0xeb675ed203749d83, 0x7d5949aed98db39f}},
    {{0xdc914aa9a47734ac, 0x1907d20404148427}},
    {{0x8ad6c00527de76a6, 0xd10757d8dda52267}},
    {{0x4e9bff19c7d88a98, 0x189a8d4e51c27e32}},
    {{0xc82870e5c822ba99, 0x69eea4f6f113d70e}},
    {{0xfd7b70ecb19d2c36, 0x7a60af7b5f21e496}},
    {{0xd37aeb5265a33c9a, 0xfe1c4f634eeb0098}},
    {{0xf6c495dc5f010dd5, 0x52d684b4d4c42125}},
    {{0xca826a63cb52248c, 0x8e7d14cdfc8259e2}},
    {{0x77625d05af877b38, 0x9f4d5547d7182400}},
    {{0x684ecfb6df61fddd, 0x8c07632cd003604f}},
    {{0x85012189410c205c, 0x895e05f7e26a901f}},
    {{0x769a27ee9591f411, 0x43b826a52886a8c0}},
    {{0x9282659e8f323485, 0x3e7a916b4e80b5c1}},
    {{0xb00194ad697d6d5e, 0x17b1edfbc8e4dfce}},
    {{0xd4c80eb9106638c1, 0x2fd1adde560bdfed}},
    {{0x29d1c1709f9d9b5f, 0x888ebf46da816979}},
    {{0x7ef8d31faeac0784, 0x78d1b858d9613bfd}},
    {{0x82f6576219416477, 0x83519a4514d41b6e}},
    {{0x553d23e9ab4e8dbd, 0xd20d98625b9d4c3c}},
    {{0xab102a5dd2128e69, 0x2d9acfbdc60aeb2a}},
    {{0xef2c8d9ea787e810, 0xe373e45729748364}},
    {{0x5f1d4f898c665b2, 0xcfd05afe5d2233a9}},
    {{0x99fe03ed4fa6a180, 0x6f941e5b54352afb}},
    {{0x587ba70858b616be, 0x3b9798ff1d45d5b2}},
    {{0xf0940c1a4d3f3c12, 0xce0a1a5ca33bd232}},
    {{0x9eb11c369d5ba89c, 0x7e03f4648427d358}},
    {{0xa5d5a1b86ea63d72, 0xf9645d5afe087241}},
    {{0xa1813a48dd63713, 0x1645b35943994f69}},
    {{0xac817ec908f68bf7, 0xa4864949696f6759}},
    {{0xe09a43b181614698, 0xf1f174744fc0d3bb}},
    {{0x52b97eed44c8a3d, 0x1898f6bd65e37938}},
    {{0xe62b8b6288fd6605, 0xe5945b8d2d08fd95}},
    {{0xdca2564997fde783, 0xe290fbbe0eaae17a}},
    {{0x2ece5624a35e3d35, 0x8d9013633e3c52d5}},
    {{0xc7003716326c9689, 0xa2e5524974aa6b1e}},
    {{0xc641209aa2a0df51, 0x3119bf6dde5c6b90}},
    {{0xd0a9c50ab8c32f6b, 0x1cc53532eb9532f6}},
    {{0x3e2a65bb1d1278aa, 0x33526447e26693e5}},
    {{0x8d2c3c00fffb7483, 0xd074e67b14d85b15}},
    {{0x9d04bd634083f922, 0xe6fbda89976f7387}},
    {{0x6fa1255d504be983, 0xdd524aa8344b60ff}},
    {{0xfc48cce99c79faf4, 0xbcdbc0b6909be8a9}},
    {{0x6f8948ab7b05eda5, 0xc17001816386e8f8}},
    {{0x4d1ab07829f8caae, 0x5090b87136c0a055}},
    {{0xa2eb337bfc759821, 0xacde2a9ed27b7a70}},
    {{0xf1af404ce2958678, 0xe97a215a57228f49}},
    {{0xf0f6d19f7f4ecba4, 0xf67fd154cb8749b2}},
    {{0x70856c94bf86c250, 0xcf6c96ab72c6e54b}},
    {{0x67fc952bf9f7b4d5, 0xd14a36862990abf0}},
    {{0x506de5b30c4f2296, 0x73b6f50e4e3ea664}},
    {{0x92b9ea73e8fa49bb, 0xa925635d5be3f935}},
    {{0xc5ded91eb9016686, 0xeabf42e38b0941e5}},
    {{0xd282475f4ec54581, 0xa3597f461a3255d3}},
    {{0x29760a6c01b97b86, 0x73d8c86923cafe16}},
    {{0xd2dc65c26eef5ec, 0xa3a0e7314e090c33}},
    {{0x69d7c95bfbf12b64, 0x393fba4504807e03}},
    {{0x71e52aaadcb68a11, 0x696656028dd325cf}},
    {{0xdae16a24a3a7cddb, 0x863c432610bcc6ab}},
    {{0x3af2329d17ff9fe5, 0x5820545546e0dcbf}},
    {{0x325871e9f0739c22, 0x9a1e1ac20012f3e2}},
    {{0xc6d619dd082ec566, 0x5658c822c2b0dc51}},
    {{0xc1e0b35b24bce3c0, 0xc8088c3e727850ab}},
    {{0x68b1f094eb726822, 0x3e9763715fc10d4e}},
    {{0xa502fd0d18c39dc3, 0xaaee49cc12d678ec}},
    {{0xdde0269e440e748a, 0xff6c20dc7e4a7c01}},
    {{0x24d9d3101294809a, 0xcdf8d964372addc6}},
    {{0xa2f3c5e270805a87, 0xc425f02355d18f52}},
    {{0xc2ff13152d8f9523, 0xa413d5b170bb801}},
};

alignas(32) constexpr static std::array<uint64_t, 2> m3_transposed[128] = {
    {{0xb454313f7cd2482e, 0x6ca177da9e0abb6d}},
    {{0x6378f0e87ae8238b, 0x1b9e92e699277d81}},
    {{0x7e1f45c9e62326a8, 0x214515f36f491a6f}},
    {{0x6abc1bae66eeb97a, 0xe60fdec8d4fcde92}},
    {{0x6c0cbdb97f4ae9fe, 0xb016328ee3251828}},
    {{0x6a6af205ba87ab2d, 0x7c4fcc7ab53c6d5b}},
    {{0x70762e40ebeb5fdc, 0x7d54d1a1a70f2c12}},
    {{0xfa4ee3a337feec94, 0x2800f65373d3d04a}},
    {{0x683e0e25c6557243, 0xb170d777b9e086cd}},
    {{0x9806c40240f2040b, 0xae0f7cc1039c12d0}},
    {{0x25134fe6710e5e4d, 0x994717c8c4903eee}},
    {{0xab111aabc1c3a131, 0xf358a17ec0a66e27}},
    {{0x69443f901e892715, 0x59957b0667f339d6}},
    {{0xdb30a65b7e4a888f, 0x6e87550227e97f04}},
    {{0xf82523d48704d267, 0xe4ab93b9ff7c303f}},
    {{0x4c729de94d821ec2, 0x6231e391fe2e3843}},
    {{0x301779d6571c5d85, 0x7ed1a4ba3b26b06e}},
    {{0xf76533a936c56672, 0x90b0c9612ef6afd}},
    {{0xa7cbc791e7d48481, 0xdf8844e3ef9520a2}},
    {{0x89534fa56fe1d6ca, 0x909fdfb43c103c7a}},
    {{0x992770dcb7d2afb8, 0x378ca3b7869e7a48}},
    {{0x769363f3eb965cb1, 0x947675140c466bb4}},
    {{0x872dabbea53e6749, 0x5724cc9b4db06691}},
    {{0x68cb1f8b2ef6cc0d, 0xa0cbd1619f287eb8}},
    {{0x27bc711cd4b537f9, 0x8719dcda719ab689}},
    {{0x1310376377515592, 0x7963dc3799812b8a}},
    {{0x9a9e6089d6b8769f, 0xffab9fe51083e2df}},
    {{0xd97ad1bea979daf5, 0x8b3634191cfb1d1f}},
    {{0xe108b82df9fa8aa2, 0xb5fc18122e9683ef}},
    {{0x5d08d927e5cb1bd6, 0x637da64fb5686aaa}},
    {{0x47f13d86b9db4bf2, 0x2fb21416ba2d1f97}},
    {{0x87b3468a3d3bb626, 0x59fa503aee6296e4}},
    {{0x9e610965fd2d1307, 0x278e6b6542c2ec51}},
    {{0xed14f2e8e42c27d8, 0x3d1b67b1e3428ea6}},
    {{0xb6b12ca5a2f93362, 0xa1105711287531fc}},
    {{0xf971f42c709e5021, 0xe9d3bbf8af42f8ce}},
    {{0x1394728087d9c24c, 0x9454ebb58883ad25}},
    {{0xd572c52637c45e47, 0x79ba87773437275}},
    {{0x80538f1e2709d381, 0xf0c382061810a366}},
    {{0x80a3946e6dee01e, 0x26d8059066ec54df}},
    {{0xb603056ae43c886f, 0x884a633da8b879a3}},
    {{0xbbd84b4e9f47ea35, 0x9ae54f2562effa55}},
    {{0x631770d77de3c93a, 0x7c07889ad267d1c5}},
    {{0xa8a1cdc95b09eca, 0x10e38646e1917d29}},
    {{0xd023d7a0028782d9, 0x6bd2e1d85a550b07}},
    {{0x98f53e69978207ff, 0x41d3723ab1f1a664}},
    {{0x6c490c02815710af, 0x60450aeffcc2eafb}},
    {{0x25126cb53bdad676, 0x284b5b980604342d}},
    {{0x73daa62aa9af66e4, 0xf944090d703e129d}},
    {{0x45903d02600b3455, 0xdc699d1ecb114151}},
    {{0xea24ea9b7318c0bd, 0x38a3eadc0a55e7da}},
    {{0xcc9e6bedb61b2e8c, 0x967d39e3a9224e9}},
    {{0x793678fc233c274b, 0xf498f9259620e7de}},
    {{0x69e380004131eda5, 0x581ea3e0ce8751dc}},
    {{0xd05773c5598852a8, 0xdfddd187c0a79396}},
    {{0xb75d214f85ed40c8, 0xe4d541304eba4917}},
    {{0xf2b34d991b846c46, 0x91156a8799ebea49}},
    {{0x3dbb9c5e2ddcf9f0, 0xc7d6895991975585}},
    {{0x1a0c39ed3393f696, 0x810f2df9e501f44e}},
    {{0x1fbeed1c30e381d, 0xf58c9e0ad5e2b144}},
    {{0x17c91758009c5cea, 0x26664cfab0d5e05a}},
    {{0xe53017b3ede7f97f, 0x529bda3444c39b59}},
    {{0x2a971ca2e97622f5, 0x9116645919252f55}},
    {{0x9b9cc9fd9292c89b, 0x176be5611c96c68a}},
    {{0x29ab049765a82163, 0x299e115fd0ccea25}},
    {{0xec206d83197a855a, 0xca7b478b15fa6a1c}},
    {{0x9af136519c1ea7c1, 0xf591d2595d9c8d21}},
    {{0x5256c8652686aa38, 0xe38ebe1ac4234cb2}},
    {{0x91d131abdb842903, 0x771a6ebf8d67138b}},
    {{0xf9dc7416dc55444a, 0x6b2e57e877e6e30c}},
    {{0x79815bd8f34bca65, 0x75b4b824855c5ccf}},
    {{0x797c9e0be1899bf, 0x7c9a6909fff34d42}},
    {{0xf8b7b48c7f4fba9b, 0x2a93f825afa8a1a3}},
    {{0xca80c5ed8010da24, 0x4081bdd570c6575c}},
    {{0x8c7b73454eed1cc0, 0xc437bad6e57ba019}},
    {{0x610cf8bc36da2eda, 0x6d5ba6a8fad88001}},
    {{0x8bbd6ce4234a6067, 0xe473adac07061c04}},
    {{0x6d71cc4a21b1f3b7, 0x975aa8da604367cd}},
    {{0x4d4887bf60679335, 0xb7fe7c1ca1bcee50}},
    {{0x9c0c0faa3c1ed352, 0x98c356b4028ca2f0}},
    {{0x37c7f2ad0f96fdc, 0x23e9f1b731973abd}},
    {{0xacab91c6c7d05a5e, 0xd3c16366f422a9a7}},
    {{0xe5b0f87b03cd3440, 0x2b8e156833e5322c}},
    {{0xa4e7f6efc00fbde9, 0x248e97bded74d75}},
    {{0xdc1b2e7c3c49a0c, 0x63990100fbf2a489}},
    {{0x4ad760b4f7781104, 0x32a8e3ec6706dde9}},
    {{0xa49897b3d43d791c, 0x624644c5eb97314}},
    {{0x4d0e0b74b30d130, 0xb81ac4c3c9ce5b11}},
    {{0x429e8aef400b14a8, 0x9b79924e4fe81c17}},
    {{0x8361912190a34cf6, 0xf794b07219f974b}},
    {{0xdfc81bdcb2e7a077, 0x6c1c1c50647186be}},
    {{0x6e550f64ea585d38, 0x6f51d36fb9e7539d}},
    {{0xe9f5bbdee4280472, 0x71e22bc54acefcb4}},
    {{0xdb4f56071a0d3815, 0x3ffa6a6a9fae0af5}},
    {{0x6790c3c1e6000469, 0xfffa5a44b28543da}},
    {{0x2139e16db6d45d6, 0x850f962d46257e0c}},
    {{0xf570e5258ae84ac5, 0x34948c2b0f0e18c7}},
    {{0x6a41a9e04f920a2f, 0x1be2935d6473e38a}},
    {{0x7d2a47619736775, 0x48f9aa111558f457}},
    {{0x7a5cc3a508fb6db, 0xe645f2c2c5366a21}},
    {{0x87390df5dbe324a7, 0x243c28fa9545d2f8}},
    {{0x2f56594a7244a5d8, 0x93c190c83af94a49}},
    {{0x5abbe1791d4e1640, 0x134d119ace4aad95}},
    {{0xd62cdd3c6cab12b3, 0xafa134652e041573}},
    {{0x85f193d3dbb78d, 0x2591e21719a01ed5}},
    {{0x6367e064aa2d5cbc, 0xd4ff318f88037dd5}},
    {{0x3c18f8511ccc3e59, 0xa6fe51ade9278394}},
    {{0x3e04d8c13f4e58a2, 0xdec5279ebd813210}},
    {{0xb1d038d773694c6f, 0xaf30425d94572242}},
    {{0x46c3e40464d44477, 0x93437d3eaeb4e3f3}},
    {{0x454f6ac1d187576f, 0xfefde4af55b44946}},
    {{0x7bcaaae6c057a078, 0x29968eb3af4342db}},
    {{0xe7577a9d33ff042f, 0x1618a6e66d14296b}},
    {{0x5f69a6e58b32bf53, 0xdf1eed3c559020b4}},
    {{0xdeb3d530be9d2d59, 0xcf78b2f647607d29}},
    {{0x16c4eed7dc3dfee1, 0x12eba08040ef2bfa}},
    {{0xcf8b1a60ec323bcd, 0xcc0f337905d142cc}},
    {{0x58781844513b136c, 0x6d05598f3d0a66f4}},
    {{0xaae98e7c5b7b9662, 0xc27e18b4a703570b}},
    {{0xff36b85b5c7551de, 0xd0f3a5619270d559}},
    {{0xd6db44e6d3688fae, 0x88af0dba3fcd5afb}},
    {{0x64c2dea8ff7ad044, 0xe4f76b675697accd}},
    {{0x90898007f31d547c, 0x33d83f3c839ca315}},
    {{0xb91074facb45d6ba, 0x2e52f0196b45c94c}},
    {{0x7e2c79191b166d79, 0x43fbb55da1486400}},
    {{0x97b5f8c933732bd5, 0x650f9ed3466cd4cb}},
    {{0x93798bbfd13e2416, 0x3632a9fd4e9660a3}},
    {{0xa0190511dfdec1c4, 0x173313dd8a95ab1a}},
};

constexpr static std::array<uint64_t, 2> const *matrix_transposed[3] = {
    m1_transposed,
    m2_transposed,
    m3_transposed,
};

bool rain(const std::vector<uint8_t> &key_in,
          const std::vector<uint8_t> &plaintext_in,
          std::vector<uint8_t> &ciphertext_out, uint8_t *witness, bool flag);

bool rain(const field::GF2_128 &key_in, const field::GF2_128 &plaintext_in,
          field::GF2_128 &ciphertext_out, uint8_t *witness, bool flag);
